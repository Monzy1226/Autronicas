<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventory Management | Autronicas</title>
  <link rel="stylesheet" href="inventory.css" />
</head>
<body>
  <header class="header">
    <h1>Inventory Management System</h1>
    <nav class="nav">
      <a href="dashboard.html"><strong>Dashboard</strong></a>
      <a href="inventory.html" class="active"><strong>Inventory</strong></a>
      <a href="sales.html"><strong>Sales</strong></a>
      <a href="index.html" id="logout"><strong>Logout</strong></a>
    </nav>
  </header>

  <main class="main-container">
    <section id="inventory-section">
      <section class="inventory-header">
        <h2 id="inventory-title">Inventory Management</h2>
        <p>Manage your inventory items, track stock levels, and monitor performance.</p>
        <div class="inventory-actions">
          <button id="add-item-btn">+ Add Item</button>
        </div>
      </section>

      <!-- Popup overlay -->
      <div id="overlay"></div>

      <!-- Popup Add Form -->
      <div id="inline-form">
        <form id="add-item-form">
          <h3>Add Item</h3>
          <input type="text" id="code" placeholder="Product Code" required />
          <input type="text" id="description" placeholder="Product Description" required />
          <input type="text" id="category" placeholder="Category" required />
          <input type="number" id="quantity" placeholder="Quantity" required />
          <input type="number" id="minQuantity" placeholder="Minimum Quantity" required />
          <input type="number" id="unitPrice" placeholder="Unit Price" required />
          <input type="text" id="srpPrivate" placeholder="Private SRP (Auto)" readonly />
          <input type="text" id="srpLGU" placeholder="LGU SRP (Auto)" readonly />
          <div style="margin-top:10px;">
            <button type="submit" id="save-btn">Save</button>
            <button type="button" id="cancel-btn">Cancel</button>
          </div>
        </form>
      </div>

      <table border="1" cellpadding="5" cellspacing="0" style="margin-top:10px; width:100%;">
        <thead>
          <tr>
            <th>Product Code</th>
            <th>Product Description</th>
            <th>Category</th>
            <th>Quantity</th>
            <th>Minimum</th>
            <th>Unit Price</th>
            <th>Private SRP</th>
            <th>LGU SRP</th>
            <th>Total Value</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="inventory-body"></tbody>
      </table>
    </section>
  </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const addBtn = document.getElementById('add-item-btn');
  const inlineForm = document.getElementById('inline-form');
  const addForm = document.getElementById('add-item-form');
  const cancelBtn = document.getElementById('cancel-btn');
  const overlay = document.getElementById('overlay');
  const tableBody = document.getElementById('inventory-body');
  const unitPriceInput = document.getElementById('unitPrice');
  const srpPrivateInput = document.getElementById('srpPrivate');
  const srpLGUInput = document.getElementById('srpLGU');
  let inventories = JSON.parse(localStorage.getItem('inventoryAll')) || [];
  let editIndex = null;

  renderInventory();

  // Auto-calculate SRPs when unit price changes
  unitPriceInput.addEventListener('input', updateSRP);

  function updateSRP() {
    const unitPrice = parseFloat(unitPriceInput.value);
    if (!isNaN(unitPrice)) {
      // Private = +25%, LGU = +60%
      const srpPrivate = Math.ceil((unitPrice * 1.25) / 10) * 10;
      const srpLGU = Math.ceil((unitPrice * 1.6) / 10) * 10;

      srpPrivateInput.value = srpPrivate.toFixed(2);
      srpLGUInput.value = srpLGU.toFixed(2);
    } else {
      srpPrivateInput.value = "";
      srpLGUInput.value = "";
    }
  }

  // Show popup form
  addBtn.addEventListener('click', () => {
    inlineForm.style.display = 'block';
    overlay.style.display = 'block';
  });

  // Hide popup
  cancelBtn.addEventListener('click', closePopup);
  overlay.addEventListener('click', closePopup);

  function closePopup() {
    inlineForm.style.display = 'none';
    overlay.style.display = 'none';
    addForm.reset();
    addBtn.disabled = false;
  }

  // Add / Edit item
  addForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const newItem = {
      code: document.getElementById('code').value.trim(),
      description: document.getElementById('description').value.trim(),
      category: document.getElementById('category').value.trim(),
      quantity: parseInt(document.getElementById('quantity').value),
      minQuantity: parseInt(document.getElementById('minQuantity').value),
      unitPrice: parseFloat(unitPriceInput.value),
      srpPrivate: parseFloat(srpPrivateInput.value),
      srpLGU: parseFloat(srpLGUInput.value)
    };

    if (editIndex !== null) {
      inventories[editIndex] = newItem;
      editIndex = null;
      alert('Item updated successfully!');
    } else {
      inventories.push(newItem);
      alert('Item added successfully!');
    }

    localStorage.setItem('inventoryAll', JSON.stringify(inventories));
    renderInventory();
    closePopup();
  });

  // Render table
  function renderInventory() {
    tableBody.innerHTML = '';
    inventories.forEach((item, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.code}</td>
        <td>${item.description}</td>
        <td>${item.category}</td>
        <td>${item.quantity}</td>
        <td>${item.minQuantity}</td>
        <td>₱${item.unitPrice.toFixed(2)}</td>
        <td>₱${item.srpPrivate.toFixed(2)}</td>
        <td>₱${item.srpLGU.toFixed(2)}</td>
        <td>₱${(item.quantity * item.unitPrice).toFixed(2)}</td>
        <td>${item.quantity <= item.minQuantity ? "<span style='color:red;'>Low</span>" : "In Stock"}</td>
        <td style="text-align:center;">
          <button class="edit" data-index="${i}">Edit</button>
          <button class="delete" data-index="${i}">Delete</button>
        </td>
      `;
      tableBody.appendChild(tr);
    });
  }

  // Edit / Delete
  tableBody.addEventListener('click', (e) => {
    if (e.target.classList.contains('edit')) {
      editIndex = e.target.dataset.index;
      const item = inventories[editIndex];
      document.getElementById('code').value = item.code;
      document.getElementById('description').value = item.description;
      document.getElementById('category').value = item.category;
      document.getElementById('quantity').value = item.quantity;
      document.getElementById('minQuantity').value = item.minQuantity;
      document.getElementById('unitPrice').value = item.unitPrice;
      document.getElementById('srpPrivate').value = item.srpPrivate.toFixed(2);
      document.getElementById('srpLGU').value = item.srpLGU.toFixed(2);
      inlineForm.style.display = 'block';
      overlay.style.display = 'block';
    }

    if (e.target.classList.contains('delete')) {
      const index = e.target.dataset.index;
      if (confirm('Are you sure you want to delete this item?')) {
        inventories.splice(index, 1);
        localStorage.setItem('inventoryAll', JSON.stringify(inventories));
        renderInventory();
      }
    }
  });
});
</script>
</body>
</html>

