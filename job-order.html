<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Job Order - Autronicas</title>
  <link rel="stylesheet" href="job-order.css" />
</head>
<body>
  <!-- SELECTION SECTION -->
  <section id="choose-type" style="text-align:center; margin-bottom: 20px;">
    <h2>Select Job Order Type</h2>
    <button id="private-btn" class="btn-primary" style="padding:10px 25px; margin:5px;">Private</button>
    <button id="lgu-btn" class="btn-secondary" style="padding:10px 25px; margin:5px;">LGU</button>
  </section>

  <!-- JOB ORDER FORM -->
  <div class="job-order-container hidden" id="jobOrderContent">
    <div class="header">
      <img src="Logo.png" alt="Company Logo" class="logo" />
      <div class="company-info">
        <h1>AUTRONICAS</h1>
        <h2>AUTO SERVICE AND SPARE PARTS CORP.</h2>
        <p>
          Maharlika Highway Sitio Bagong Tulay, Brgy. Bukal, Pagbilao, Quezon<br />
          Contact Info: (042) 785-0428 | 0998-999-0252<br />
          Email: autronicas.official@gmail.com
        </p>
      </div>
    </div>

    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
      <h3 id="jobOrderTitle" style="margin:0;">JOB ORDER (Private)</h3>
      <h4 style="margin:0; margin-right:30px;">Job Order No: <span id="jobOrderNumber">1</span></h4>
    </div>

    <hr class="divider">

    <div class="job-info">
      <div class="left">
        <label><strong>Name / Company:</strong></label>
        <input type="text" class="input-line" placeholder="Enter name or company" />
        <br><br>
        <label><strong>Address:</strong></label>
        <input type="text" class="input-line" placeholder="Enter address" />
      </div>
      <div class="right">
        <label><strong>Contact No.:</strong></label>
        <input type="text" class="input-line" placeholder="Enter contact number" />
      </div>
    </div>

    <table class="details-table">
      <tr>
        <td><strong>Model:</strong> <input type="text"></td>
        <td><strong>Plate No.:</strong> <input type="text"></td>
      </tr>
      <tr>
        <td><strong>Motor Chasis:</strong> <input type="text"></td>
        <td><strong>Time In:</strong> <input type="text"></td>
        <td><strong>Date:</strong> <input type="text"></td>
      </tr>
      <tr>
        <td><strong>Vehicle Color:</strong> <input type="text"></td>
        <td><strong>Fuel Level:</strong> <input type="text"></td>
        <td><strong>Engine Number:</strong> <input type="text"></td>
      </tr>
    </table>

    <!-- LABOR SECTION -->
    <table class="job-table">
      <tr class="section-header">
        <th colspan="5">
          <div class="section-header-content">
            <span class="section-title-text">LABOR</span>
            <button class="add-btn" onclick="addRow('laborRows')">+ Add Row</button>
          </div>
        </th>
      </tr>
      <tr>
        <th>JOB DESCRIPTION</th>
        <th>QTY</th>
        <th>UNIT</th>
        <th>UNIT PRICE</th>
        <th>AMOUNT</th>
      </tr>
      <tbody id="laborRows">
        <tr>
          <td><input type="text" placeholder="Enter labor details..." /></td>
          <td><input type="number" min="1" placeholder="0" oninput="updateTotal()" /></td>
          <td><input type="text" placeholder="pcs/hr" /></td>
          <td><input type="number" min="0" placeholder="0.00" oninput="updateTotal()" /></td>
          <td><input type="number" min="0" placeholder="0.00" readonly /></td>
        </tr>
      </tbody>
    </table>

    <!-- PARTS SECTION -->
    <table class="job-table">
      <tr class="section-header">
        <th colspan="5">
          <div class="section-header-content">
            <span class="section-title-text">PARTS</span>
            <button class="add-btn" onclick="addRow('partsRows')">+ Add Row</button>
          </div>
        </th>
      </tr>
      <tr>
        <th>JOB DESCRIPTION</th>
        <th>QTY</th>
        <th>UNIT</th>
        <th>UNIT PRICE</th>
        <th>AMOUNT</th>
      </tr>
      <tbody id="partsRows">
        <tr>
          <td><input type="text" placeholder="Enter part details..." /></td>
          <td><input type="number" min="1" placeholder="0" oninput="updateTotal()" /></td>
          <td><input type="text" placeholder="pcs" /></td>
          <td><input type="number" min="0" placeholder="0.00" oninput="updateTotal()" /></td>
          <td><input type="number" min="0" placeholder="0.00" readonly /></td>
        </tr>
      </tbody>
    </table>

    <!-- TOTAL -->
    <div style="text-align:right; margin-top:5px;">
      <strong>TOTAL AMOUNT: </strong><span id="totalAmount"><strong>‚Ç±0.00</strong></span>
    </div>

    <p class="note">I AGREE THAT ALL WORK HAS BEEN PERFORMED TO MY SATISFACTION.</p>

    <div class="signatures">
      <div>Mechanic/Technician</div>

      <div>Mrs. Herminia Baracael<br /><small>Chief of Operation Officer</small></div>
    </div>

    <div class="received-section">
      <p>Received by: ___________________________</p>
      <p>(Signature over printed name)</p>
    </div>
  </div>

  <div class="actions" style="text-align:center; margin-top:20px;">
    <button onclick="printJobOrder()">üñ® Print Job Order</button>
  </div>

  <script>
// === Add Row (Specific Section) ===
function addRow(sectionId) {
  const tbody = document.getElementById(sectionId);
  const row = document.createElement("tr");
  row.innerHTML = `
    <td><input type="text" placeholder="Enter details..." /></td>
    <td><input type="number" min="1" placeholder="0" oninput="updateTotal()" /></td>
    <td><input type="text" placeholder="pcs/hr" /></td>
    <td><input type="number" min="0" placeholder="0.00" oninput="updateTotal()" /></td>
    <td><input type="number" min="0" placeholder="0.00" readonly /></td>
  `;
  tbody.appendChild(row);
  updateTotal();
}

// === Update Total Amount for All Rows ===
function updateTotal() {
  let total = 0;

  ["laborRows", "partsRows"].forEach(id => {
    const rows = document.querySelectorAll(`#${id} tr`);
    rows.forEach(row => {
      const qtyInput = row.querySelector('td:nth-child(2) input');
      const unitPriceInput = row.querySelector('td:nth-child(4) input');
      const amountInput = row.querySelector('td:nth-child(5) input');

      const qty = parseFloat(qtyInput?.value) || 0;
      const price = parseFloat(unitPriceInput?.value) || 0;
      const amount = qty * price;

      if (amountInput) {
        amountInput.value = amount.toFixed(2);
      }

      total += amount;
    });
  });

  document.getElementById("totalAmount").innerHTML = `<strong>‚Ç±${total.toFixed(2)}</strong>`;
}

// === Print Job Order ===
function printJobOrder() {
  const chooseSection = document.getElementById("choose-type");
  if (chooseSection) chooseSection.style.display = "none";

  const content = document.getElementById("jobOrderContent");
  content.classList.remove("hidden");

  window.print();

  if (chooseSection) chooseSection.style.display = "block";
}

// === Toggle Between Job Order Types ===
document.getElementById("private-btn").addEventListener("click", function() {
  document.getElementById("jobOrderTitle").innerText = "JOB ORDER (Private)";
  document.getElementById("jobOrderContent").classList.remove("hidden");
});

document.getElementById("lgu-btn").addEventListener("click", function() {
  document.getElementById("jobOrderTitle").innerText = "JOB ORDER (LGU)";
  document.getElementById("jobOrderContent").classList.remove("hidden");
});

let jobOrderCounter = 1;
let currentType = "";
let currentDate = new Date().toISOString().split("T")[0];
let savedOrders = []; // store job order data objects

// === Type Selection ===
document.getElementById("private-btn").addEventListener("click", function() {
  currentType = "Private";
  showJobOrderForm();
});

document.getElementById("lgu-btn").addEventListener("click", function() {
  currentType = "LGU";
  showJobOrderForm();
});

// === Show Job Order Form ===
function showJobOrderForm() {
  document.getElementById("choose-type").style.display = "none";
  document.getElementById("jobOrderContent").classList.remove("hidden");
  document.getElementById("jobOrderTitle").innerText = `JOB ORDER (${currentType})`;
  document.getElementById("jobOrderNumber").innerText = jobOrderCounter;

  // Create header nav bar
  let headerBar = document.getElementById("headerButtons");
  if (!headerBar) {
    headerBar = document.createElement("div");
    headerBar.id = "headerButtons";
    headerBar.style.display = "flex";
    headerBar.style.justifyContent = "center";
    headerBar.style.alignItems = "center";
    headerBar.style.gap = "8px";
    headerBar.style.marginBottom = "10px";

    headerBar.innerHTML = `
      <button id="backBtn" class="nav-btn" onclick="goBack()">‚Üê</button>
      <button id="saveBtn" class="nav-btn" onclick="saveJobOrder()">üíæ Save</button>
      <button id="nextBtn" class="nav-btn" onclick="nextJobOrder()">‚Üí</button>
      <select id="jobIndicator" class="indicator" onchange="loadSelectedOrder(this.value)"></select>
    `;
    document.getElementById("choose-type").insertAdjacentElement("afterend", headerBar);
  }

  updateIndicator();
  headerBar.style.display = "flex";
}

// === Update Dropdown Indicator ===
function updateIndicator() {
  const indicator = document.getElementById("jobIndicator");
  indicator.innerHTML = "";

  savedOrders.forEach((order, index) => {
    const opt = document.createElement("option");
    opt.value = index;
    opt.text = `${order.type} #${order.number} ‚Äî ${order.date}`;
    indicator.appendChild(opt);
  });

  const currentOpt = document.createElement("option");
  currentOpt.text = `${currentType} #${jobOrderCounter} ‚Äî ${currentDate}`;
  currentOpt.value = "current";
  currentOpt.selected = true;
  indicator.appendChild(currentOpt);

  document.getElementById("jobOrderNumber").innerText = jobOrderCounter;
}

// === Save Job Order ===
function saveJobOrder() {
  currentDate = new Date().toISOString().split("T")[0];

  const jobData = {
    type: currentType,
    number: jobOrderCounter,
    date: currentDate,
    fields: collectInputs(),
    labor: collectTableData("laborRows"),
    parts: collectTableData("partsRows"),
    total: document.getElementById("totalAmount").innerText
  };

  // if already exists, overwrite
  const index = savedOrders.findIndex(
    o => o.type === currentType && o.number === jobOrderCounter
  );

  if (index >= 0) {
    savedOrders[index] = jobData;
    alert(`üíæ Updated: ${currentType} #${jobOrderCounter}`);
  } else {
    savedOrders.push(jobData);
    alert(`üíæ Saved: ${currentType} #${jobOrderCounter}`);
  }

  // ‚úÖ Automatically increment job order number and clear for next one
  jobOrderCounter++;
  clearInputs();

  updateIndicator();
}

// === Collect all form inputs ===
function collectInputs() {
  const data = {};
  document.querySelectorAll("#jobOrderContent input[type='text']").forEach((input, i) => {
    data[`field${i}`] = input.value;
  });
  return data;
}

// === Collect labor/parts tables ===
function collectTableData(sectionId) {
  const rows = [];
  document.querySelectorAll(`#${sectionId} tr`).forEach(row => {
    const inputs = row.querySelectorAll("input");
    if (inputs.length > 0) {
      rows.push({
        desc: inputs[0].value,
        qty: inputs[1].value,
        unit: inputs[2].value,
        price: inputs[3].value,
        amount: inputs[4].value
      });
    }
  });
  return rows;
}

// === Load job order by index ===
function loadSelectedOrder(index) {
  if (index === "current") return;
  const order = savedOrders[index];
  if (!order) return;

  currentType = order.type;
  jobOrderCounter = order.number;

  // Fill text inputs
  const inputs = document.querySelectorAll("#jobOrderContent input[type='text']");
  let i = 0;
  for (const key in order.fields) {
    if (inputs[i]) inputs[i].value = order.fields[key];
    i++;
  }

  // Load labor & parts
  loadTable("laborRows", order.labor);
  loadTable("partsRows", order.parts);

  document.getElementById("totalAmount").innerHTML = order.total;
  updateIndicator();
}

// === Load table data ===
function loadTable(sectionId, data) {
  const tbody = document.getElementById(sectionId);
  tbody.innerHTML = "";

  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input type="text" value="${row.desc}" /></td>
      <td><input type="number" value="${row.qty}" oninput="updateTotal()" /></td>
      <td><input type="text" value="${row.unit}" /></td>
      <td><input type="number" value="${row.price}" oninput="updateTotal()" /></td>
      <td><input type="number" value="${row.amount}" readonly /></td>
    `;
    tbody.appendChild(tr);
  });
}

// === Back Button ===
function goBack() {
  if (jobOrderCounter > 1) {
    jobOrderCounter--;
    loadJobIfExists();
  } else {
    document.getElementById("jobOrderContent").classList.add("hidden");
    document.getElementById("choose-type").style.display = "block";
    document.getElementById("headerButtons").style.display = "none";
  }
}

// === Next Button ===
function nextJobOrder() {
  jobOrderCounter++;
  clearInputs();
  updateIndicator();
  alert(`‚û°Ô∏è New Job Order #${jobOrderCounter}`);
}

// === Load existing job order if it exists ===
function loadJobIfExists() {
  const existing = savedOrders.find(
    o => o.type === currentType && o.number === jobOrderCounter
  );
  if (existing) loadSelectedOrder(savedOrders.indexOf(existing));
  else clearInputs();
}

// === Clear all fields ===
function clearInputs() {
  document.querySelectorAll("#jobOrderContent input").forEach(i => {
    if (!i.readOnly) i.value = "";
  });
  document.getElementById("totalAmount").innerHTML = "<strong>‚Ç±0.00</strong>";
  document.getElementById("laborRows").innerHTML = "";
  document.getElementById("partsRows").innerHTML = "";
  addRow("laborRows");
  addRow("partsRows");
}

// === Add Row ===
function addRow(sectionId) {
  const tbody = document.getElementById(sectionId);
  const row = document.createElement("tr");
  row.innerHTML = `
    <td><input type="text" placeholder="Enter details..." /></td>
    <td><input type="number" min="1" placeholder="0" oninput="updateTotal()" /></td>
    <td><input type="text" placeholder="pcs/hr" /></td>
    <td><input type="number" min="0" placeholder="0.00" oninput="updateTotal()" /></td>
    <td><input type="number" min="0" placeholder="0.00" readonly /></td>
  `;
  tbody.appendChild(row);
}

// === Update Totals ===
function updateTotal() {
  let total = 0;
  ["laborRows", "partsRows"].forEach(id => {
    const rows = document.querySelectorAll(`#${id} tr`);
    rows.forEach(row => {
      const qty = parseFloat(row.querySelector('td:nth-child(2) input')?.value) || 0;
      const price = parseFloat(row.querySelector('td:nth-child(4) input')?.value) || 0;
      const amount = qty * price;

      const amountInput = row.querySelector('td:nth-child(5) input');
      if (amountInput) amountInput.value = amount.toFixed(2);

      total += amount;
    });
  });

  document.getElementById("totalAmount").innerHTML = `<strong>‚Ç±${total.toFixed(2)}</strong>`;
}

// === Print Job Order ===
function printJobOrder() {
  const chooseSection = document.getElementById("choose-type");
  const headerButtons = document.getElementById("headerButtons");

  if (chooseSection) chooseSection.style.display = "none";
  if (headerButtons) headerButtons.style.display = "none";

  window.print();

  if (headerButtons) headerButtons.style.display = "flex";
}

  </script>
</body>
</html>
