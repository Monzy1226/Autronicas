<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Autronicas Dashboard</title>
  <link rel="stylesheet" href="dashboard.css" />
</head>
<body>
  <header class="header">
    <h1>Inventory Management System</h1>
    <nav class="nav">
      <a href="dashboard.html" class="active"><strong>Dashboard</strong></a>
      <a href="inventory.html"><strong>Inventory</strong></a>
      <a href="sales.html"><strong>Sales</strong></a>
      <a href="index.html" id="logout"><strong>Logout</strong></a>
    </nav>
  </header>

  <main class="main-container fade-in">
    <section class="stats">
      <div class="card">
        <h3>Total Items</h3>
        <p id="total-items">0</p>
      </div>
      <div class="card">
        <h3>Total Value</h3>
        <p id="total-value">₱0.00</p>
      </div>
      <div class="card">
        <h3>Categories</h3>
        <p id="total-categories">0</p>
      </div>
      <div class="card">
        <h3>Low Stock</h3>
        <p id="low-stock">0</p>
      </div>
    </section>

    <section id="low-stock-alert" class="alert hidden">
      <h4>⚠️ Low Stock Alert</h4>
      <p id="low-stock-list"></p>
    </section>

    <section class="breakdown">
      <h2>Product Category Breakdown</h2>
      <table id="category-table">
        <thead>
          <tr>
            <th>Category</th>
            <th>Current</th>
            <th>Minimum</th>
            <th>Total Value</th>
          </tr>
        </thead>
        <tbody>
          <!-- dynamically generated -->
        </tbody>
      </table>
    </section>
  </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const totalItemsEl = document.getElementById('total-items');
  const totalValueEl = document.getElementById('total-value');
  const totalCategoriesEl = document.getElementById('total-categories');
  const lowStockEl = document.getElementById('low-stock');
  const lowStockListEl = document.getElementById('low-stock-list');
  const lowStockAlert = document.getElementById('low-stock-alert');
  const categoryTableBody = document.querySelector('#category-table tbody');

  function getAllInventories() {
    const privateInv = JSON.parse(localStorage.getItem('inventoryPrivate')) || [];
    const lguInv = JSON.parse(localStorage.getItem('inventoryLGU')) || [];
    return [...privateInv, ...lguInv]; // Combine both
  }

  function updateDashboard() {
    const inventory = getAllInventories();

    const totalItems = inventory.length;
    const totalValue = inventory.reduce((sum, i) => sum + i.unitPrice * i.quantity, 0);
    const categories = [...new Set(inventory.map(i => i.category))].length;
    const lowStockItems = inventory.filter(i => i.quantity <= i.minQuantity);

    totalItemsEl.textContent = totalItems;
    totalValueEl.textContent = "₱" + totalValue.toFixed(2);
    totalCategoriesEl.textContent = categories;
    lowStockEl.textContent = lowStockItems.length;

    // Low stock alert
    if (lowStockItems.length > 0) {
      lowStockAlert.classList.remove('hidden');
      lowStockListEl.innerHTML = lowStockItems
        .map(i => `<p style="color:red">${i.description} — ${i.quantity} left</p>`)
        .join('');
    } else {
      lowStockAlert.classList.add('hidden');
    }

    // Category breakdown
    categoryTableBody.innerHTML = '';
    const grouped = {};
    inventory.forEach(i => {
      if (!grouped[i.category]) {
        grouped[i.category] = { current: 0, min: 0, value: 0 };
      }
      grouped[i.category].current += i.quantity;
      grouped[i.category].min += i.minQuantity;
      grouped[i.category].value += i.quantity * i.unitPrice;
    });

    Object.entries(grouped).forEach(([cat, data]) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${cat}</td>
        <td>${data.current}</td>
        <td>${data.min}</td>
        <td>₱${data.value.toFixed(2)}</td>
      `;
      categoryTableBody.appendChild(tr);
    });
  }

  // Auto-update dashboard when inventory changes
  window.addEventListener('storage', updateDashboard);

  // Also refresh every 1s to catch same-tab updates
  setInterval(updateDashboard, 1000);

  updateDashboard();
});
</script>
</body>
</html>

